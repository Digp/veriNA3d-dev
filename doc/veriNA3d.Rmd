---
title: "Use cases of veriNA3d"
author:
  - name: Diego Gallego Perez
    affiliation:
    - University of Barcelona - Dept. Biochemistry and Molecular Biomedicine
    - Institute for Research in Biomedicine - (IRB Barcelona), Barcelona 
        Institute of Science and Technology
date: "`r Sys.Date()`"
output: BiocStyle::pdf_document
bibliography: references.bib
vignette: >
  %\VignetteIndexEntry{}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
    collapse   = TRUE,
    comment    = "#>",
    message    = FALSE,
    warning    = FALSE,
    fig.width  = 6,
    fig.height = 2,
    fig.wide   = TRUE
)

```
# Introduction: Structural Bioinformatics in R

The R language provides an excellent interface for statistical analysis, which
is also interesting from the point of view of structural data. This gap was 
filled in 2006 by the R package 
[bio3d](http://thegrantlab.org/bio3d/) [@Grant2006]. 
It was presented as a 
suite of tools to handle PDB formated structures, and trajectories. 
It integrates a variety of functions to analyse from 
sequence to 3D structure data (RMSD, NMA, PCA... see their 
[documentation](http://thegrantlab.org/bio3d/html/index.html) for details).
As far as we know, bio3d represented the only structural package for R until
now.

The R package presented in here, veriNA3d, does not replace bio3d at all.
Rather, it was developed on top of it to cover additional necessities. 
The only common tool integrated in both packages is a parser for mmCIF files
(see below). veriNA3d is mainly intended (but not limited) to the analysis of 
Nucleic Acids. It integrates a higher level of abstraction than bio3d since it
also allows the analysis of datasets, in addition to analysis of single
structures. The functions in the package could be divided in the following 
blocks:

* Dataset level: Functions to get and analyse lists of pdb IDs. This includes
access to the [representative lists of RNA](
http://rna.bgsu.edu/rna3dhub/nrlist/)
by [@Leontis2012] and other analytical functions.

* Structure level: Functions to get data, parse mmCIF files and analyse these
data.

* Plots: examples to show the results of the previous analysis.

The complete list of functions can be found in the README.md file within the
package, also accessible on the gitlab 
[main page](http://mmb.irbbarcelona.org/gitlab/dgallego/veriNA3d).

# Parsing mmCIF files

## Origin and standardization of mmCIF files

Atomic structural data of macromolecules has long been distributed in the PDB
file format. However, one of its main limitations is the column size for the 
coordinates data, which didn't allowed to save molecules with more than 99999
atoms, more than 62 chains or more than 9999 residues (in a chain).

Given that the Protein Data Bank is continously growing and accepting bigger
structures (e.g. a whole *E.coli* ribosome has over 140000 atoms - pdbID 4V4S),
an alternative file format became the standard: the mmCIF file format.

The mmCIFs are an evolution of the Crystallographic Information File (CIF), 
originally used for small molecule structures. It stands for 
**m**acro**m**olecular **CIF** file, and it has actually coexisted with the PDB
format since the 1997. However, since the PDB is easier to parse and such big
structures didn't populate the database at the time, most software has been
developed for the PDB format.

The PDB format was definetely frozen in 2014. However, it will still coexist
with the standard mmCIF format as long as all softwares evolve to accept
mmCIFs. Following this trend, the bio3d R package integrated a read.cif 
function in their version 2.3. At that time, we had already started the 
development of our own cifParser function. Given that the mmCIF format is
constantly evolving and that both functions take slightly different approaches,
we decided to offer our own version of it, which might provide an useful and
fast alternative for users working with mmCIF files.

## The CIF object

Parsing a particular file format often involves creating a new class of object.
In R, the principal [objects](http://adv-r.had.co.nz/OO-essentials.html) are 
called S3, S4 and RC. Our container for mmCIF data is an S4 object called 
**CIF**, in contrast with the S3 object (called **pdb**) in bio3d - it is 
worth noting that this difference does **not** affect the compatibility 
between the two packages (see below for details).

Since different mmCIF files usually have different sections of data 
(in addition to the coordinates), we carried out an analisis that checked 
which ones are always present in all mmCIF files (this included all mmCIF 
files in the Protein Data Bank in March 2018), and reached a list of 14
items:

* Atom\_site
* Atom\_sites
* Atom\_type
* Audit\_author
* Audit\_conform
* Chem\_comp
* Database\_2
* Entity
* Entry
* Exptl
* Pdbx\_database\_status
* Struct
* Struct\_asym
* Struct\_keywords 

The detailed description of each data sections can be found in the
mmCIF [main site](http://mmcif.wwpdb.org/).

The CIF object is created by the `cifParser` function and contains these 14
sections of data, which can be accessed with the CIF accessors. To see the
accessor functions run:

```{r ?cif_accessors}
library(veriNA3d)
?cif_accessors
```


To read a mmCIF file and access the coordinates data, use:

```{r cifParser(pdbID)}
## To parse a local mmCIF file:
# cif <- cifParser("your-file.cif")
## To download from PDB directly:
cif <- cifParser("1bau")
cif
## To see the coordinates:
coords <- cifAtom_site(cif)
head(coords)
```


## Bidirectional compatibility with bio3d

Using the `cifPArser` will often be the first step to analyse a structure. 
However, if the analisys requires any of the bio3d functions, then a 
conversion should be done with the `cifAsPDB` function.

```{r cifAsPDB(cif)}
pdb <- cifAsPDB(cif)
pdb
```

It takes a CIF object and generates an equivalent pdb object (as used by all 
bio3d functions). In addition, all veriNA3d functions are prepared to accept 
as input either the CIF or pdb objects. Therefore, the compatibility between
the two packages is bidirectional.


# Manage Nucleic Acid datasets

Get Leontis list, change representative structures and analyse them with one 
of the pipelines

# Querying the EMBL-EBI REST API

An invaluable resource for structural & computational biologists is the 
[PDBe REST API](https://www.ebi.ac.uk/pdbe/pdbe-rest-api) [@Velankar2015]

```{r echo=FALSE, fig.fullwidth=TRUE}
knitr::include_graphics('./PDBe_REST_API.png')
```

# Calculate the \(\epsilon\)RMSD

For two NMR models of RNA/DNA, compute the eRMSD

# Generate substructures

For a given structure (CIF or pdb), generate a smaller PDB with the region of 
interest and surroundings

# References
